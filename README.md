# 透過MRI影像分析失智相關性

## nii影像放大

在這段MATLAB的程式碼中主要目的是批量處理 MRI 影像文件，計算每個影像的體積，並將結果儲存到 CSV 文件中。此外，還會將擴張後的影像和差集影像保存到指定的資料夾中。

以下是對程式碼的簡要介紹：

1. **設置路徑**:
   - 設定影像目錄 `inputDir` 和輸出 CSV 文件的路徑 `outputCSV`。
   - 設定存儲擴張後影像和差集影像的資料夾 `dilatedDir` 和 `differenceDir`，並創建這些資料夾（如果尚未存在）。

2. **獲取影像文件**:
   - 使用 `dir` 函數獲取指定目錄下所有的 NIfTI 影像文件。

3. **處理每個影像文件**:
   - 循環處理每個影像文件：
     - 讀取影像文件，獲取影像數據和影像信息。
     - 使用高斯濾波器去除噪聲。
     - 填充影像以避免擴張時裁切，然後進行影像擴張。
     - 去除填充部分，修剪擴張後的影像，使其與原始影像大小相同。
     - 計算差集影像，即擴張後影像與去噪影像的差值。
     - 計算每個影像的體積，這包括原始影像、擴張後影像和差集影像的體積。

4. **儲存結果**:
   - 將每個影像的計算結果（影像名稱、原始體積、擴張後體積、差集體積）存儲到 `results` 儲存陣列中。
   - 顯示處理進度。

5. **保存處理後的影像**:
   - 保存擴張後影像和差集影像到指定的資料夾中，使用 `niftiwrite` 函數。

6. **儲存結果到 CSV 文件**:
   - 將 `results` 陣列轉換為表格，並將其儲存為 CSV 文件 `outputCSV`。

### 主要變數和函數
- `niftiread` 和 `niftiinfo`：讀取 NIfTI 影像和獲取影像信息。
- `imgaussfilt3`：進行三維高斯濾波去除噪聲。
- `padarray` 和 `imdilate`：影像填充和擴張。
- `niftiwrite`：將處理後的影像保存為 NIfTI 格式。
- `cell2table` 和 `writetable`：將結果儲存為 CSV 文件。

這段程式碼能夠自動處理一個資料夾中的所有 NIfTI 影像，計算體積，並將結果保存到指定的資料夾和 CSV 文件中，非常適合大規模影像數據的批量處理。

## 頭顱大小計算

這段 MATLAB 程式碼的主要目的是讀取指定資料夾中的 MRI 影像，對顱骨進行閾值分割，計算顱骨的邊界框並提取其尺寸，然後將結果儲存到 CSV 文件中。以下是程式碼的簡要介紹：

1. **設置影像目錄與閾值**:
   - `imageDir`：設置包含 NIfTI 影像的資料夾路徑。
   - `imageFiles`：使用 `dir` 函數獲取指定目錄下所有的 NIfTI 影像文件。
   - `lower_threshold` 和 `upper_threshold`：設定用於分割顱骨的閾值範圍。

2. **初始化結果儲存**:
   - `results`：初始化儲存影像處理結果的空儲存陣列。

3. **處理每個影像文件**:
   - 循環處理每個影像文件：
     - 讀取影像文件和影像信息。
     - 根據閾值分割顱骨，使用 `bone_mask` 來生成顱骨的二值遮罩。
     - 使用 `bwareaopen` 函數移除小區域，並使用 `imfill` 函數填充孔洞，確保顱骨的遮罩完整。
     - 獲取影像的像素間距（`spacing`），這是影像在空間中的實際尺寸。
     - 使用 `regionprops3` 函數計算顱骨的邊界框（Bounding Box），這是包圍顱骨的最小立方體。
     - 如果找到顱骨邊界框，計算其實際尺寸（`width`、`height` 和 `depth`），這些尺寸是基於邊界框和影像像素間距計算的。
     - 如果未找到顱骨邊界框，則設置為 `NaN`。
     - 儲存影像處理結果，包括影像名稱、顱骨的長、寬、高。

4. **顯示進度**:
   - 顯示目前處理的影像文件名稱，以便跟蹤處理進度。

5. **儲存結果**:
   - 確保 `results` 變數格式正確，並將結果轉換為表格 `resultsTable`。
   - 使用 `writetable` 函數將表格儲存為 CSV 文件 `MRI_BoneMeasurements.csv`，包含每個影像的顱骨尺寸數據。

### 主要變數和函數
- `niftiread` 和 `niftiinfo`：讀取 NIfTI 影像數據和獲取影像信息。
- `bwareaopen` 和 `imfill`：用於處理二值影像的功能，移除小區域並填充孔洞。
- `regionprops3`：計算三維影像的區域屬性，這裡用來獲取顱骨的邊界框。
- `cell2table` 和 `writetable`：將結果轉換為表格並儲存為 CSV 文件。

這段程式碼可以有效地批量處理 MRI 影像，計算每個影像的顱骨尺寸，並將結果儲存為 CSV 文件，便於後續分析和處理。
